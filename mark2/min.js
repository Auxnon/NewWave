var focused,apps,svg,path,bar,mainTitle,appPoints,mouseObj,points,barMove=!1,barPos=1,moveFactor=0,count=0,tick=!1,lastDir=!1,barLineFactor=1,targetMove=void 0,targetPoint={x:0,y:0};function init(t){let e=document.querySelectorAll(".app");apps=[],e.forEach(t=>{apps.push(t)}),apps.forEach((t,e)=>{t.style.top=Math.random()*window.innerWidth+"px",t.style.left=Math.random()*window.innerHeight+"px",t.offset={x:0,y:0},t.addEventListener("pointerdown",e=>{appMouseDown(t,e)}),t.addEventListener("dragstart",t=>{t.preventDefault()})}),window.addEventListener("pointerup",winMouseUp),path=document.querySelector("path"),svg=document.querySelector("svg"),mainTitle=document.querySelector("#mainTitle"),mouseObj={x:window.innerWidth/2,y:-200},window.addEventListener("resize",resize),initLine(),window.addEventListener("pointermove",mousemove),barInit(),resize(),animate(),setInterval(()=>{boundaryCheck()},3e3);let a=document.querySelector("#brightness");a.addEventListener("click",t=>{a.classList.contains("brightnessDark")?(document.body.style.backgroundColor="black",svg.style.stroke="white",mainTitle.style.border="white 5px solid",mainTitle.style.stroke="white"):(document.body.style.backgroundColor="white",svg.style.stroke="black",mainTitle.style.border="black 5px solid",mainTitle.style.stroke="black"),a.classList.toggle("brightnessDark")})}function resize(){svg.setAttribute("width",window.innerWidth+"px"),svg.setAttribute("height",window.innerHeight+"px"),barCalculate()}function rand(){return 100*Math.random()-50}function initLine(){points=[];for(let t=0;t<10;t++)points.push({x:mouseObj.x,y:mouseObj.y})}function barInit(){bar=document.querySelector("#bar");let t=document.querySelector("#barHandle");t.addEventListener("pointerdown",t=>{barBox.left,barBox.top;if(barMove=!0,points.length<10){let t=points[0],e=Array(7).fill(t);points=e.concat(points)}barLineFactor=0}),t.addEventListener("dragstart",t=>{t.preventDefault()}),appPoints=[],t.style.transform="translate(-50%,-200%)",bar.style.left="50%",bar.style.top=window.innerHeight-64+"px",barCalculate(!0)}function barCalculate(t){let e=0,a=[],o=0==barPos||2==barPos;t?(e=apps.length,a=apps):apps.forEach(t=>{-1!=t.spot&&(a.push(t),e++)}),o?(bar.style.height=128*(e>0?e:1)+"px",bar.style.width="128px"):(bar.style.width=128*(e>0?e:1)+"px",bar.style.height="128px");let r=bar.getBoundingClientRect();barBox=r;let n,i=r.width,s=r.height;n=o?s/e:i/e,t||(o?a.sort(function(t,e){return parseInt(t.style.top)-parseInt(e.style.top)}):a.sort(function(t,e){return parseInt(t.style.left)-parseInt(e.style.left)}));for(let l=0;l<e;l++)appPoints[l]=o?{x:r.left+i/2,y:64+r.top+l*n}:{x:64+r.left+l*n,y:r.top+s/2},targetMove&&targetMove==a[l]&&(targetPoint=appPoints[l]),t&&(apps[l].spot=l,appPoints[l].app=a[l]),_moveEle(a[l],appPoints[l].x,appPoints[l].y);if(-1==barLineFactor){let t=barHandle.getBoundingClientRect();if(o){let e=t.left+t.width/2;drawSimpleBarLine({x:e,y:t.top},{x:e,y:t.bottom})}else{let e=t.top+t.height/2;drawSimpleBarLine({x:t.left,y:e},{x:t.right,y:e})}}}function animate(){if(barLineFactor>-1)if(barLineFactor<4){if(barLineFactor){let t={},e=barHandle.getBoundingClientRect(),a={x:e.width/2,y:e.height/2};if(0==barPos||2==barPos)switch(barLineFactor){case 3:t={x:e.left+a.x,y:e.top};break;case 2:t={x:e.left+a.x,y:e.top+a.y};break;default:t={x:e.left+a.x,y:e.bottom}}else switch(barLineFactor){case 3:t={x:e.left,y:e.top+a.y};break;case 2:t={x:e.left+a.x,y:e.top+a.y};break;default:t={x:e.right,y:e.top+a.y}}let o=mouseObj.x-t.x,r=mouseObj.y-t.y,n=Math.sqrt(o*o+r*r);mouseObj.x-=o/2,mouseObj.y-=r/2,n<1&&barLineFactor<4&&barLineFactor++}let t={x:mouseObj.x-points[0].x,y:mouseObj.y-points[0].y},e=Math.sqrt(t.x*t.x+t.y*t.y);if(e>40){let a;a=barLineFactor>1?{x:mouseObj.x,y:mouseObj.y}:{x:mouseObj.x-20*(tick?1:-1)*t.y/e,y:mouseObj.y+20*(tick?1:-1)*t.x/e};Math.abs(t.x)>Math.abs(t.y)?t.x:t.y;tick=!tick,drawBarLine(a)}}else{if(barLineFactor%5==1){let t=points.shift();console.log("chop off points "+points.length),points.length<=3?(barLineFactor=-1,barCalculate()):drawBarLine(t)}-1!=barLineFactor&&barLineFactor++}targetMove&&moveFactor++,requestAnimationFrame(animate)}function drawBarLine(t){let e="M"+mouseObj.x+" "+mouseObj.y,a={x:t.x,y:t.y};for(let t=0;t<points.length;t++){let o=(points[t].y-a.y)/2,r=(points[t].x-a.x)/2,n=a.x+r,i=a.y+o;e+="Q"+a.x+" "+a.y+" "+n+" "+i;let s={x:points[t].x,y:points[t].y};points[t]={x:a.x,y:a.y},a=s}path.setAttribute("d",e)}function drawSimpleBarLine(t,e){let a="M"+t.x+" "+t.y+"L"+e.x+" "+e.y;path.setAttribute("d",a)}function mousemove(t){if(barMoveHandler(t),targetMove){if(moveFactor++,targetMove.pos={x:t.clientX+targetMove.offset.x,y:t.clientY+targetMove.offset.y},t.clientY>barBox.top&&t.clientY<barBox.bottom&&t.clientX>barBox.left&&t.clientX<barBox.right){let t=targetPoint,e={x:t.x-targetMove.pos.x,y:t.y-targetMove.pos.y};targetMove.pos={x:t.x-e.x/3,y:t.y-e.y/3},targetMove.moving&&(targetMove.moving=void 0,targetMove.spot=0,barCalculate())}else targetMove.moving||(targetMove.moving=!0,targetMove.spot=-1,barCalculate());targetMove.style.left=targetMove.pos.x+"px",targetMove.style.top=targetMove.pos.y+"px"}else 0==barLineFactor&&(count>2&&(count=0,mouseObj={x:t.clientX,y:t.clientY}),count++)}function barMoveHandler(t){if(barMove){let e=t.clientX,a=t.clientY,o=e-window.innerWidth/2,r=a-window.innerHeight/2,n=Math.atan2(r,o)/Math.PI,i=Math.abs(n);i<.25?2!=barPos&&(barPos=2,bar.style.left=window.innerWidth-64+"px",bar.style.top="50%",barCalculate(),barHandle.style.transform="translate(-200%,-50%)",barHandle.style.width="64px",barHandle.style.height="80%",mainTitle.style.top="28px"):i<.75?(n<0?3!=barPos&&(barPos=3,barHandle.style.transform="translate(-50%,100%)",bar.style.left="50%",bar.style.top="64px",mainTitle.style.top="calc(100% - 128px)"):1!=barPos&&(barPos=1,barHandle.style.transform="translate(-50%,-200%)",bar.style.left="50%",bar.style.top=window.innerHeight-64+"px",mainTitle.style.top="28px"),barCalculate(),barHandle.style.height="64px",barHandle.style.width="80%"):0!=barPos&&(barPos=0,barHandle.style.transform="translate(100%,-50%)",bar.style.left="64px",bar.style.top="50%",barCalculate(),barHandle.style.width="64px",barHandle.style.height="80%",mainTitle.style.top="28px")}}function appMouseDown(t,e){t.focused||(targetMove=t,t.pos={x:parseInt(t.style.left),y:parseInt(t.style.top)},targetPoint={x:t.pos.x,y:t.pos.y},t.offset={x:t.pos.x-e.clientX,y:t.pos.y-e.clientY},t.classList.add("appMove"),t.moving=void 0),moveFactor=0}function winMouseUp(t){barMove&&(barMove=!1,barLineFactor=1),targetMove?(targetMove.classList.remove("appMove"),moveFactor<20?focused&&focused==targetMove?(targetMove.classList.remove("appMax"),focused=void 0,targetMove.style.zIndex=2):(targetMove.classList.add("appMax"),focused&&(focused.classList.remove("appMax"),focused.style.zIndex=2),targetMove.style.zIndex=0,focused=targetMove):(barCalculate(),console.log("fix bar also"))):(barCalculate(),console.log("fix bar")),targetMove=void 0}function boundaryCheck(){apps.forEach(t=>{if(!t.focused){let e=t.getBoundingClientRect(),a=e.left,o=e.top,r=(e.right-e.left)/2,n=(e.bottom-e.top)/2;a<0?t.style.left=r+"px":a>window.innerWidth-2*r&&(t.style.left=window.innerWidth-r+"px"),o<0?t.style.top=n+"px":o>window.innerHeight-2*n&&(t.style.top=window.innerHeight-n+"px")}})}function _moveEle(t,e,a,o){o||(t.pos={x:e,y:a}),t.style.left=e+"px",t.style.top=a+"px"}init();