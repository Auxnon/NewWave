<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		body{
			background-color: black;
			overflow: hidden;
			touch-action:none;
		}
		.app{
			position: absolute;
			background-color: red;
			border-radius:  16px;
			width: 128px;
			height: 128px;
			left: 128px;
			top: 128px;
			transform: translate(-50%,-50%);
			transition: 0.4s;
			z-index: 1;
		}
		.appMove{
			border-top: 6px white solid;
			transition: border-radius 0.4s, width 0.4s, height 0.4s;
		}
		#bar{
			position: absolute;
			width: 256px;
			height: 128px;
			border-radius: 32px;
			background-color: #4444;
			bottom: 64px;
			left: 50%;
			transform: translate(-50%,-50%);
		}
		.appMax{
			width: 100%;
			height: 100%;
			border-radius: 0px;
			top: 50% !important;
			left: 50% !important;
		}
		#two{
			background-color: blue;
			left: 256px;
			top: 264px;
		}
		#thr{
			background-color: green;
			left: 356px;
			top: 34px;
		}
		svg{
			position: absolute;
			left: 0;
			top: 0;
			margin:0;
			pointer-events: none;
		}


	</style>
</head>
<body>
	<div id="bar"></div>
	<div class="app" id="one"></div>
	<div class="app" id="two"></div>
	<div class="app" id="thr"></div>
	<svg stroke="white" fill="none" stroke-width="6" stroke-linecap="round">
		<path d="M0 0 L 100 100"/>	
	</svg>
</body>
<script>
	var focused;
	var apps;
	var svg;
	var path;
	var bar;
	var appPoints;
	function init(argument) {
		// body...
		let preApps=document.querySelectorAll('.app');
		apps=[]
		preApps.forEach(app=>{ //convert out of a nodelist to an array, it matters trust me
			apps.push(app)
		})
		apps.forEach((app,index)=>{
			app.style.top=Math.random()*512+'px'
			app.style.left=Math.random()*512+'px'
			app.addEventListener('click',ev=>{
				
			})
			app.origin={x:0,y:0};
			app.offset={x:0,y:0};
			//app.addEventListener('mousedown',ev=>{appMouseDown(app,ev);})
			app.addEventListener('pointerdown',ev=>{appMouseDown(app,ev);})
		})
		window.addEventListener('pointerup',winMouseUp)
		/*setInterval(()=>{
			apps.forEach(app=>{
				app.style.top=parseInt(app.style.top)+rand()+'px'
				app.style.left=parseInt(app.style.left)+rand()+'px'
				
			})
		},1000);*/
		path=document.querySelector('path')
		svg=document.querySelector('svg')
		resize();
		window.addEventListener('resize', resize);
		initLine();
		window.addEventListener('pointermove',mousemove)
		window.addEventListener('click',click)

		mouseObj={x:0,y:0}
		
		barInit();
		animate();
		
	}init();
	function resize(){
		svg.setAttribute('width',window.innerWidth+"px")
		svg.setAttribute('height',window.innerHeight+"px")
	}
	function rand(){
		return Math.random()*100 -50;
	}
	//var mousePrev={x:0,y:0}
	var mouseObj;
	var points
	function initLine(){
		points=[];
		for(let i=0;i<10;i++){
			points.push({x:0,y:0});
		}
	}
	var count=0;
	var tick=false;
	var lastDir=false
	var mouseToggle=0;
	var targetMove=undefined;

	function click(){
		if(mouseToggle>0)
			mouseToggle=0;
		else
			mouseToggle=1;
	}
	function barInit(){
		bar=document.querySelector('#bar');
		
		appPoints=[];
		
		barCalculate(true);
	}
	function barCalculate(notate){

		
		let count=0;
		if(notate){
			apps.forEach(app=>{
				if(app.spot!=-1)
					count++;
			})
		}else{
			count=apps.length;
		}
		
		bar.style.width=count*128+'px'

		let rect = bar.getBoundingClientRect();
		console.log(rect.top, rect.right, rect.bottom, rect.left);
		let width=rect.right-rect.left;
		let height=rect.bottom-rect.top;
		let ratio=width/(count+2);

		if(!notate)
			apps.sort(function(a, b) {
			  //sort by x, secondary by y
			  return parseInt(a.style.left) - parseInt(b.style.left);
			});
		
		for(let i=0;i<count;i++){
			appPoints[i]={x:rect.left+(i+1)*ratio,y:rect.top+height/2};

			let app=apps[i]

			if(notate){
				apps[i].spot=i;
				appPoints[i].app=apps[i]
				_moveEle(appPoints[i].app,appPoints[i].x,appPoints[i].y)

			}else{
				_moveEle(apps[i],appPoints[i].x,appPoints[i].y)
			}

			
			
			
		}
		

			
	}
	function animate(){
			if(mouseToggle){
				let target={};
				switch(mouseToggle){
					case 2: target={x:100,y:200};break;
					case 3: target={x:100,y:600};break;
					default:target={x:100,y:100}
				}
				let dx=mouseObj.x-target.x;
				let dy=mouseObj.y-target.y;
				let dr=Math.sqrt(dx*dx +dy*dy)
				mouseObj.x-=dx/20
				mouseObj.y-=dy/20
				if(dr<1 && mouseToggle<3 )
					mouseToggle++;
			}

		
			let diff={x:mouseObj.x-points[0].x,y:mouseObj.y-points[0].y}
			let dr=Math.sqrt(diff.x*diff.x + diff.y*diff.y)

			
			if(dr>40){


				let fresh;
				if(mouseToggle>1){
					fresh={x:mouseObj.x,y:mouseObj.y};
				}else{
					fresh={x:mouseObj.x-(tick?1:-1)*20*diff.y/dr,y:mouseObj.y+(tick?1:-1)*20*diff.x/dr};
				}
				

				/*mouseObj.x-=(tick?1:-1)*20*diff.y/dr;
				mouseObj.y+=(tick?1:-1)*20*diff.x/dr;*/
				let dir=Math.abs(diff.x)>Math.abs(diff.y);
				let pos=dir?diff.x>0:diff.y>0
				/*if(dir!=lastDir)
					tick=!tick
				lastDir=dir*/
				tick=!tick

				let st="M"+mouseObj.x+" "+mouseObj.y;
				let last={x:fresh.x,y:fresh.y};
				for(let i=0;i<points.length;i++){
					let halfy=(points[i].y-last.y)/2
					let halfx=(points[i].x-last.x)/2
					let midx=last.x+halfx;
					let midy=last.y+halfy;
					st+="Q"+last.x+" "+last.y+" "+midx+" "+midy//+points[i].x+" "+points[i].y

					let prev={x:points[i].x,y:points[i].y};
					points[i]={x:last.x,y:last.y};
					last=prev;
				}
				path.setAttribute('d',st)
			}

		requestAnimationFrame(animate);
	}
	
	function mousemove(ev){
		if(targetMove){

			targetMove.pos={x:ev.clientX+targetMove.offset.x,y:ev.clientY+targetMove.offset.y}
			/*let d={x:targetMove.origin.x-targetMove.pos.x,y:targetMove.origin.y-targetMove.pos.y}
			let dr=Math.sqrt(d.x*d.x +d.y*d.y);
			if(dr<80){
				targetMove.pos={x:targetMove.origin.x-d.x/3,y:targetMove.origin.y-d.y/3}
				if(targetMove.moving){
					targetMove.moving=undefined
					//targetMove.classList.remove('appMove')
				}
			}else{
				if(!targetMove.moving){
					targetMove.moving=true;
					//targetMove.classList.add('appMove')
				}
			}*/
			targetMove.spot=-1;

			appPoints.forEach((point,index)=>{
				let d={x:point.x-targetMove.pos.x,y:point.y-targetMove.pos.y}
				let dr=Math.sqrt(d.x*d.x +d.y*d.y);


				if(dr<40){
					targetMove.pos={x:point.x-d.x/3,y:point.y-d.y/3}
					if(targetMove.moving){
						targetMove.moving=undefined;
						apps.forEach(app=>{
							_moveEle(app,app.pos.x,app.pos.y)
						});
						//targetMove.classList.remove('appMove')
					}
					if(point.app==targetMove){

					}else{ //switcheroo the app icons
						//let oldPoint=appPoints[targetMove.spot];
						let swapApp=point.app;
						targetMove.spot=index;
						apps.forEach(app=>{
							if(app==targetMove){

							}else{
								if(app.pos.x>targetMove.pos.x){
									_moveEle(app,64+app.pos.x,app.pos.y,true)
								}else{
									_moveEle(app,-64+app.pos.x,app.pos.y,true)
								}
							}

						})
						//_moveEle()

						//oldPoint.app=swapApp;
						//swapApp.pos.x=oldPoint.x; swapApp.pos.x=oldPoint.y;
						//_moveEle(swapApp,swapApp.pos.x,swapApp.pos.y);
						//swapApp.spot=targetMove.spot;

						//point.app=targetMove; targetMove.spot=index;

					}
				}else{
					if(!targetMove.moving){
						targetMove.moving=true;
						//targetMove.classList.add('appMove')
						/*apps.forEach(app=>{
							_moveEle(app,app.pos.x,app.pos.y)
						});*/
					}
				}
			})
			
			targetMove.style.left=targetMove.pos.x+'px'
			targetMove.style.top=targetMove.pos.y+'px'
		}else if(mouseToggle==0){
			if(count>2){
				count=0;
				/*let dd={x:mouseObj.x-ev.clientX,y:mouseObj.y-ev.clientY}
				mouseObj.x-=dd.x/20
				mouseObj.y-=dd.y/20*/
				mouseObj={x:ev.clientX,y:ev.clientY}
				/*

				let last={x:mouseObj.x,y:mouseObj.y,dir:dir,pos:pos};
				let lastMode=-1;
				for(let i=0;i<points.length;i++){
					//st+="M"+last.x+" "+last.y
					let halfy=(points[i].y-last.y)/2
					let halfx=(points[i].x-last.x)/2
					if(lastMode==-1){
						lastMode=(Math.abs(halfx)<Math.abs(halfy))?1:0
					}
					if(points[i].dir==last.dir){
						if(!last.dir){ //up down dir //points[i].dir
							st+="Q"+last.x+" "+(last.y+halfy)+" "+(last.x+halfx)+" "+(last.y+halfy);
							st+="Q"+points[i].x+" "+(last.y+halfy)+" "+points[i].x+" "+points[i].y;
						}else{ //left right dir
							st+="Q"+(last.x+halfx)+" "+last.y+" "+(last.x+halfx)+" "+(last.y+halfy);
							st+="Q"+(last.x+halfx)+" "+points[i].y+" "+points[i].x+" "+points[i].y;
							
						}
					}else{ //curve in then
						if(last.dir){ // true is x left right
							if((halfy>0)!=last.pos){
								st+="C"+(last.x)+" "+(last.y-halfy)+" "+(last.x+halfx)+" "+(last.y-halfy)+" "+(last.x+halfx)+" "+(last.y+halfy);

								st+="Q"+(last.x+halfx)+" "+(last.y+halfy)+" "+points[i].x+" "+points[i].y;
														console.log('special')


							}else{
								st+="Q"+(points[i].x)+" "+last.y+" "+points[i].x+" "+points[i].y;
							}
							
						}else{
							st+="Q"+(last.x)+" "+points[i].y+" "+points[i].x+" "+points[i].y;
						}
					}
					
					

					


					let prev={x:points[i].x,y:points[i].y,dir:points[i].dir,pos:points[i].pos};
					points[i]={x:last.x,y:last.y,dir:last.dir,pos:last.pos};
					last=prev;
				}*/
				

				//mousePrev=mouseObj;
			}count++
		}
		
		
	
	}

	function appMouseDown(app,ev){
		targetMove=app;
		app.pos={x:parseInt(app.style.left),y:parseInt(app.style.top)}
		app.origin={x:app.pos.x,y:app.pos.y}
		app.offset={x:app.pos.x-ev.clientX,y:app.pos.y-ev.clientY}
		app.classList.add('appMove')
		app.moving=undefined;
	}

	function winMouseUp(ev){
		if(targetMove){
			targetMove.classList.remove('appMove')
			if(!targetMove.moving){
				if(focused && focused==targetMove){
						targetMove.classList.remove('appMax')
						focused=undefined;
						targetMove.style.zIndex=1;
				}else{
					targetMove.classList.add('appMax')
					if(focused){
						focused.classList.remove('appMax')
						focused.style.zIndex=1;
					}
					targetMove.style.zIndex=0;
					focused=targetMove;
				}
			}else{
				barCalculate();
			}
		}
		targetMove=undefined;
	}

	function _moveEle(ele,x,y,bool){
		if(!bool)
			ele.pos={x:x,y:y}
		ele.style.left=x+'px'
		ele.style.top=y+'px'
	}

</script>
</html>